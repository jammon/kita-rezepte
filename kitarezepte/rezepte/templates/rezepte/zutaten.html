{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% csrf_token %} 
{% block content %}
  <div class="row">
    <div class="col">
      {% if zutaten %}
      <h1>Zutaten</h1>
      <table class="table table-sm">
        <tr>
          <th>Name</th>
          <th class="text-right">Preis</th>
          <th class="text-right">Menge</th>
          <th>Kategorie</th>
          <th>Verwendung</th>
        </tr>
      {% for z in zutaten  %}
        <tr>
          <td>{{ z.name }}</td>
          <td class="text-right">
            <span class="zutat-preis">
              <input type="text" zutat_id="{{ z.id }}" 
              {% if z.preis is None %}
                     value="" origvalue=""
              {% else %}
                     value="{{ z.preis|intcomma }}" 
                     origvalue="{{ z.preis|intcomma }}" 
              {% endif %}
                     size="6">
            </span>
            &euro;
          </td>
          <td class="text-right">{{ z.menge_pro_einheit }} {{ z.masseinheit }} </td>
          <td>{{ z.kategorie }} </td>
          <td>
            {% if z.rezepte__count %}
              {{ z.rezepte__count }} Rezept{{ z.rezepte__count|pluralize:"e" }}
            {% else %}
              kein Rezept
            {% endif %}
          </td>
          <td>
            {% if user.is_authenticated %}
              <form action="delete" method="post">{% csrf_token %}
                <a class="btn btn-primary btn-sm" href="{{ z.id }}" role="button">
                  Bearbeiten</a>
                <input type="hidden" name="zutat_id" value="{{ z.id }}">
                {% if not z.rezepte__count %}
                  <button class="btn btn-primary btn-sm" tabindex="-1">Löschen</button>
                {% endif %}
              </form>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
      </table>
      {% else %}
        <p>Es sind noch keine Zutaten eingegeben.</p>
        {% if user.is_authenticated %}
          <p>Sie können eine Sammlung häufig verwendeter Zutaten importieren.</p>
          <div><a href="zutaten/import" class="btn btn-primary" role="button">Zutaten importieren</a></div>
        {% endif %}
      {% endif %}
    </div>
    
  </div>
  <span class="zutat-preis-input hidden">
    <input type="text" value="" size="6"></span>
{% endblock content %}
{% block extrascripts %}
{% if user.is_authenticated %}
<script src="{% static 'vendor/underscore.js' %}"></script>
<script src="{% static 'vendor/backbone.js' %}"></script>
<script src="{% static 'rezepte/js/main.js' %}"></script>
<script src="{% static 'rezepte/js/zutaten.js' %}"></script>
{% endif %}
{% endblock extrascripts %}
